---
title: "Lab14_DataBetas"
author: "Brandon Nelsen. David Washburn, Burke Parent, Drew Hoffman, Tanner Ball"
date: "12/5/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(modelr)
source("http://www.openintro.org/stat/data/cdc.R")
cdc <- as_tibble(cdc)
```

Group Section:

Overall question: What is the overall average difference in weight vs desired weight between men and women?

New Tools: Permutation Test

Answer: Based on the permutation test we can conclude that women on average tend to want to change their weight more than men. The permutation test shows the distribition of the difference of desired weight change between men and women. The purple line shows the average of the permutation test, this line is also further to the right which supports our conclusion that women tend to want to change their weight more than men.

```{r}

#get desired weight change column
cdc <- mutate(cdc, wtchange = wtdesire - weight)

#filter between male and female
overall <- select(cdc, wtchange)
male <- filter(cdc, gender == "m") %>% select(wtchange)
female <- filter(cdc, gender == "f") %>% select(wtchange)

#get some means

mean(overall$wtchange) # = -14.5891
mean(male$wtchange) # = -10.70613
mean(female$wtchange) # = -18.15118

#permutation test
  #i will conduct the test by filtering male and female dataset, then subtracting the values randomly as abs(female)-abs(male). this will give a histogram that shows how much more one gender wants weight change than the other. we use absolute values because we care only about how much they want to change their weight and not the direction in which the weight changes

vector.change <- vector("double", length = 1000)
for(i in seq_along(vector.change)){
  vector.change[i] <- abs(sample_n(female, 1)) - abs(sample_n(male, 1))
}

change <- unlist(vector.change)

#plot the distribution
  #the purple line shows the average of the generated data set, blue shows the average desired weight change for males, red for females, and yellow for the average of the actual data sat
  #as we can see the purple line is significantly further away from any of the other lines. since this line has a positive x-value, we can deduce that women on average want to change their weight more than men.


ggplot() + geom_histogram(aes(change), bins = 50) +
  geom_vline(xintercept = -10.70613, color = "blue") + #male
  geom_vline(xintercept = -18.15118, color = "red") + #female
  geom_vline(xintercept =  mean(change), color = "purple") + #scrambled data 
  geom_vline(xintercept =  -14, color = "yellow") + #scrambled data
  ggtitle("Permutation Test of Female - Male Desired Weight Change") +
  xlab("Female - Male Desired Change (in pounds)") +
  ylab("Count")
```

Subsections:

David Subquestion:
I will be using recently learned tools to better answer my initial question from the original lab.
Question: How does age effect desired weight change?
This Question is important because it can give us insight as to how different age groups behave. For example, if we were to conclude that a certain age group wanted to change their weight, we could market gym memberships to that specific age group.

New Tools: Permutation Test - I will be scrambling "age" to determine if their is a difference between age group and desired weight change.
Null Hypothesis: There is no difference in desired weight change among different age groups.
Alternate Hypothesis: There is a difference in desired weight change among different age groups.
Test Statistic: Average desired weight change of each age group.

Answer: Based on the test below, we can conclude that there is a difference among age groups in desired weight change. This, we reject the null hypothesis in favor of the alternate. The group that demonstrated the greatest want to change was the 51-61 age group while the group that cared the least was the 84-99 age group.

```{r}

#Start by recreating the original plot which provided the initial conclusion
  
  #select relevent columns

cdc <- select(cdc, gender, age, weight, wtdesire)

  #plot

ggplot(data = cdc, mapping = aes(x = age, y = wtdesire - weight, color = gender)) +
  geom_smooth(se = FALSE) +
  ggtitle("Desired Weight Change VS Age") +
  xlab("Age") +
  ylab("Desired Change (in pounds)")
  
cdc <- mutate(cdc, wtchange = wtdesire - weight)

#get averages for age groups

mean(`1828` <- filter(cdc, age <= 25)$wtchange) #= -7.477639
mean(`2939` <- filter(cdc, age >= 29 & age <= 39)$wtchange) #= -15.34444
mean(`4050` <- filter(cdc, age >= 40 & age <= 50)$wtchange) #= -17.86249
mean(`5161` <- filter(cdc, age >= 51 & age <= 61)$wtchange) #= -19.33836
mean(`6272` <- filter(cdc, age >= 62 & age <= 72)$wtchange) #= -15.31537
mean(`7383` <- filter(cdc, age >= 73 & age <= 83)$wtchange) #= -8.842179
mean(`8499` <- filter(cdc, age >= 84 & age <= 99)$wtchange) #= -3.003891



#Create the permutation test

  #Filter to make a weight and wtdesire data frame

cdc.weight <- select(cdc, "weight")
cdc.wtdesire <- select(cdc, "wtdesire")   

  #generate differences

vector.wtchange <- vector("double", length = 1000)
for(i in seq_along(vector.wtchange)){
  vector.wtchange[i] <- sample_n(cdc.wtdesire, 1) - sample_n(cdc.weight, 1)

}

  #make it a data frame, i now have a bunch of weight differences, the variable that was scrambled was age

wtchange.df <- unlist(vector.wtchange)
mean(wtchange.df)

  #plot distribution of desired weight change differences. purple line denotes sample mean, yellow denotes the age group of 51-61 which is the group that had the largest desired change.
ggplot() + geom_histogram(aes(wtchange.df), bins = 50) +
  geom_vline(xintercept = -19, color = "yellow") + #age 51 - 61
  geom_vline(xintercept =  mean(wtchange.df), color = "purple") + #scrambled data
  ggtitle("Permutation Test of Desired Weight Change") +
  xlab("Desired Weight Change") +
  ylab("Count")

```

Tanner Subquestion:
I will be creating a model to help answer my question from the original lab.

Question: Is there a noticeable difference between men and women on how much they want their weight to change? Furthermore, is there a difference in desired weight change between those who have worked out in the last month and those that haven't?

New Tool: Linear Modeling - I wanted to try out modeling the data and getting a prediction for desired weight change in males and females who have exercised recently and who have not exercised recently.

Answer: Here we get a much clearer look at how the different genders want their weight to change. In general, females want to lose more weight than men do. A potentially surprising result we get from this model is that we see that people who have not exercised in the last month want to lose more weight on average than those who have exercised recently. Perhaps this is because recent exercisers have already lost some weight and thus don't feel like they need to lose as much as non-exercisers?
```{r}
#install.packages("ggpubr")
# library used to arrange the two plots on the same page
library(ggpubr)

# original graph:
ggplot(data=cdc, mapping=aes(x = gender, y = wtdesire-weight)) + geom_jitter(mapping=aes(color=gender))+facet_wrap(~ exerany)

# separate by recent exercise
ex1 <- filter(cdc, exerany == 1)
ex0 <- filter(cdc, exerany == 0)

# generate our models and data grids
modelEx1 <- lm(wtdesire-weight ~ gender, data = ex1)
gridEx1 <- cdc %>% data_grid(gender) %>% add_predictions(modelEx1)
modelEx0 <- lm(wtdesire-weight ~ gender, data = ex0)
gridEx0 <- cdc %>% data_grid(gender) %>% add_predictions(modelEx0)

ex1plot <- ggplot(ex1, aes(gender)) + geom_point(aes(y = wtdesire-weight)) + geom_point(gridEx1, mapping = aes(y=pred), color="red", size=4) + geom_text(gridEx1, mapping = aes(x=gender, y=pred, label=round(pred, 2)), hjust=-0.2, vjust=0) + xlab("Gender") + ylab("Desired Weight - Current Weight") + ggtitle("Desired Weight Change for Males and Females \n who have Exercised in the Last Month") + theme(plot.title = element_text(size = 10, hjust = 0.5)) + ylim(-250, 250)
#ex1plot

ex0plot <- ggplot(ex0, aes(gender)) + geom_point(aes(y = wtdesire-weight)) + geom_point(gridEx0, mapping = aes(y=pred), color="red", size=4) + geom_text(gridEx0, mapping = aes(x=gender, y=pred, label=round(pred, 2)), hjust=-0.2, vjust=0) + xlab("Gender") + ylab("Desired Weight - Current Weight") + ggtitle("Desired Weight Change for Males and Females \n who have not Exercised in the Last Month") + theme(plot.title = element_text(size = 10, hjust = 0.5)) + ylim(-250, 250)
#ex0plot

ggarrange(ex0plot, ex1plot + rremove("y.title"))
```


Summary of who did what:

David: Permutation test for overall question
Tanner: Individual section